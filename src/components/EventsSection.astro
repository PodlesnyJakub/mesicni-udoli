---
type EventEntry = { name: string; date: string; image: string; description: string };
const eventFiles = import.meta.glob('/content/events/*/index.json', { eager: true, import: 'default' });
const events = Object.values(eventFiles) as EventEntry[];
---

<section id="akce" class="flex flex-col items-center justify-center py-32 bg-brand-bg">
  <div class="flex flex-col gap-16 items-center w-full max-w-352 px-8 lg:px-0">

    <!-- Heading -->
    <div class="flex flex-col gap-4 items-center text-center w-full">
      <h2 class="font-oi font-normal text-[64px] leading-[1.3] tracking-[1.28px] text-brand-heading text-center m-0 w-full">
        Akce na osadě
      </h2>
      <p class="font-hepta font-medium text-[32px] text-brand-subheading text-center m-0 leading-[normal]">
        Pravidelné i nepravidelné akce<br />konané u nás na osadě
      </p>
    </div>

    <!-- Event rows -->
    <ul class="list-none m-0 w-full flex flex-col">
      {events.map((ev, i) => (
        <li class="flex items-center h-20 border-t-2 border-white relative text-2xl text-white">
          <span class="font-hepta font-bold">{ev.name}</span>
          <span class="font-hepta font-bold absolute left-1/2 -translate-x-1/2 text-center whitespace-nowrap">
            {ev.date}
          </span>
          <button
            data-modal-index={i}
            class="ml-auto font-inter font-normal text-2xl text-white underline uppercase whitespace-nowrap hover:text-brand-orange cursor-pointer bg-transparent border-0 p-0"
          >
            více info
          </button>
        </li>
      ))}
    </ul>

  </div>
</section>

<!-- Modal -->
<dialog
  id="event-modal"
  class="bg-white flex flex-col gap-12 p-12 rounded-[64px] w-195 max-w-[calc(100vw-2rem)] max-h-[90vh] overflow-y-auto border-0 shadow-2xl"
>
  <div class="relative rounded-4xl overflow-hidden h-105 shrink-0 w-full">
    <img id="modal-image" src="" alt="" class="absolute inset-0 w-full h-full object-cover" />
  </div>
  <div class="flex flex-col gap-8 pb-12">
    <h3 id="modal-title" class="font-hepta font-bold text-[64px] leading-none text-black m-0"></h3>
    <p id="modal-description" class="font-hepta font-medium text-[24px] leading-normal text-black m-0"></p>
  </div>
</dialog>

<style>
  dialog:not([open]) {
    display: none;
  }

  dialog[open] {
    position: fixed;
    inset: 0;
    margin: auto;
  }

  dialog::backdrop {
    background: rgba(0, 0, 0, 0.6);
  }
</style>

<script is:inline define:vars={{ events }}>
  const modal = document.getElementById("event-modal");
  const modalImage = document.getElementById("modal-image");
  const modalTitle = document.getElementById("modal-title");
  const modalDescription = document.getElementById("modal-description");

  document.querySelectorAll("[data-modal-index]").forEach((btn) => {
    btn.addEventListener("click", () => {
      const ev = events[Number(btn.dataset.modalIndex)];
      modalImage.src = ev.image;
      modalImage.alt = ev.name;
      modalTitle.textContent = ev.name;
      modalDescription.textContent = ev.description;
      modal.showModal();
    });
  });

  modal.addEventListener("click", (e) => {
    if (e.target === modal) modal.close();
  });
</script>
